@{
    ViewBag.Title = "ClassRoom";
}

<!DOCTYPE html>
<html>
<head>
    <title>SignalR Simple Chat</title>
    <style type="text/css">
    </style>
    
</head>
<body>
    <div class="container">
        <div id="message-panel" class="panel panel-default">
            <div class="panel-body">
                <input type="text" id="question" />
                <input type="button" id="toss-question" value="Toss" />
            </div>
        </div>
        <div id="professor-panel" class="panel panel-default">
            <div class="panel-heading">
                <p class="panel-title">For professors: </p>
            </div>
            <div class="panel-body">
                <input name="classname" type="text" placeholder="class name" />
                <input name="code" type="text" placeholder="code" />
                <input name="start-class" type="button" value="Start Class" />
            </div>

            <input name="username" type="hidden" />
                
        </div>
        <div id="student-panel" class="panel panel-default">
            <div class="panel-heading">
                <p class="panel-title">For students: </p>
            </div>
            <div class="panel-body">
                <input name="code" type="text" placeholder="code" />
                <input name="join-class" type="button" value="Join Class" />
            </div>

            <input name="username" type="hidden" />
            <input name="prof-conn-id" type="hidden" />
        </div>
        <div id="questions-panel" class="panel panel-default">
            <div class="panel-heading">
            <p class="panel-title">Questions</p>
            </div>
            <div class="panel-body">
                <ul id="questions">
                </ul>
            </div>
        </div>

        @*<div id="login-panel" class="panel panel-default">
        </div>
        <div id="register-panel" class="panel panel-default">
        </div>
        <div id="about" class="panel panel-default">
        </div>*@
        
    </div>
    <audio id="question-audio">
        <source src="~/Resource/Audios/alert1.mp3" type="audio/mpeg">
        Your browser does not support the audio tag.
    </audio>
    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="~/Scripts/jquery-1.11.1.min.js"></script>
    <!--Bootstrap-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">
        $(function () {
            // Declare a proxy to reference the hub. 
            var chat = $.connection.classRoomHub;
            // Create a function that the hub can call to broadcast messages.
            chat.client.postQuestion = function (q) {
                // Html encode display name and message. 
                var encodedMsg = $('<div />').text(q).html();
                // Add the message to the page. 
                $('#questions').append('<li>' + encodedMsg + '</li>');
                document.getElementById('question-audio').play();
            };
            
            var className=$("#professor-panel input[name='classname']");
            var profCode = $("#professor-panel input[name='code']");
            var profUserName = $("#professor-panel input[name='username']");
            var studCode = $("#student-panel input[name='code']");
            var profConnID = $("#student-panel input[name='prof-conn-id']");
            var studUserName = $("#student-panel input[name='username']");
            var question = $("#question");
            
            $("#professor-panel input[name='start-class']").on("click", function () {
                $.ajax({
                    url: "@Url.Action("StartClass", "Professor")",
                    type: "POST",
                    dataType: "json",
                    data: { classname: className.val(), code: profCode.val() },
                    success: function (data, textStatus, jqXHR) {
                        if (data["status"] == "StartClassSucceed") {
                            alert("code: " + data["code"]);
                            chat.server.StartClass(data["classID"]);
                        }
                        else {
                            alert(data["msg"]);
                        }
                    },

                });
            });

            $("#student-panel input[name='join-class']").on("click", function () {
                $.ajax({
                    url: "@Url.Action("JoinClass", "Student")",
                    type: "POST",
                    dataType: "json",
                    data: { code: studCode.val() },
                    success: function (data, textStatus, jqXHR) {
                        if (data["status"] == "JoinClassSucceed") {
                            profConnID.val(data["profConnID"]);
                            alert(data["msg"]);
                        }
                        else {
                            alert(data["msg"]);
                        }
                    },

                });
            });

            

            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#toss-question').click(function () {
                    chat.server.Toss(studUserName.val(), question.val(), profConnID.val());
                    // Clear text box and reset focus for next comment. 
                    $('#question').val('').focus();
                });
            });
        });
    </script>
</body>
</html>

